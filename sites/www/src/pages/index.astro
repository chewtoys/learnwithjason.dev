---
import Layout from '../layouts/Layout.astro';
import SEO from '../components/seo.astro';
import { SectionHero } from '../components/section-hero.solid';
import { getLatestEpisode, getNextEpisode } from '../util/sanity';
import { Poster } from '../components/poster.solid';

const title = 'Learn. Build. Grow. Together.';
const description =
	'Learn from the web’s leading experts. Build something new. Grow your career. Let’s do it together.';

const shareTitle = 'Learn With Jason';

const [latestEpisode, nextEpisode] = await Promise.all([
	getLatestEpisode(),
	getNextEpisode(),
]);
---

<Layout title={title}>
	<Fragment slot="head-tags">
		<SEO title={title} shareTitle={shareTitle} description={description} />
	</Fragment>

	<section class="block content">
		<h2 class="heading"><mark>Learn</mark> from the web’s leading experts.</h2>
		<p class="lede">
			Every Thursday, Jason pair programs with the brightest minds in web
			development to learn something new in 90 minutes.<br />
			<a href="/schedule" class="section-link">See who’s teaching next &rarr;</a
			>
		</p>

		<div class="episodes">
			<div class="latest">
				<h3>Latest episode:</h3>
				<a href={latestEpisode.slug}>
					<Poster
						slug={latestEpisode.slug}
						title={latestEpisode.title}
						guest={latestEpisode.guest}
						youtube_id={latestEpisode.youtube_id}
						type="poster"
						class="poster"
					/>
				</a>
				<div class="details">
					<p>{latestEpisode.description}</p>
					<a href={latestEpisode.slug} class="big-link">Watch Now</a>
				</div>
			</div>

			{
				nextEpisode ? (
					<div class="next">
						<h3>Next episode:</h3>
						<a href={nextEpisode.slug}>
							<Poster
								slug={nextEpisode.slug}
								title={nextEpisode.title}
								guest={nextEpisode.guest}
								youtube_id={latestEpisode.youtube_id}
								type="poster"
								class="poster"
							/>
						</a>
						<div class="details">
							<p>{nextEpisode.description}</p>
							<a href={nextEpisode.slug} class="big-link">
								See Details
							</a>
						</div>
					</div>
				) : null
			}
		</div>
	</section>
</Layout>

<style>
	.content {
		background: var(--color-gray-lightest);
		border-top: 1px solid var(--color-gray-lighter);
		padding-inline: max(5vw, calc((100vw - 75ch) / 2));
	}

	.content:nth-child(even) {
		background-color: var(--color-white);
	}

	.heading {
		font-size: clamp(1.25rem, 4vw, 1.875rem);
		line-height: 1.1;
		margin: 0;
		padding: 0;
		text-align: left;
		width: 100%;
	}

	.lede {
		font-size: clamp(1rem, 2.5vw, 1.25rem);
		margin: 0.5rem auto 0 0;
		max-width: 54ch;
	}

	.subscribe-bar {
		align-items: center;
		display: flex;
		gap: 1.5rem;
		justify-content: center;
		margin-top: 1rem;
	}

	.subscribe-bar a {
		aspect-ratio: 1;
		width: min(12%, 3.5rem);
	}

	.subscribe-bar svg {
		aspect-ratio: 1;
		width: 100%;
	}

	.subscribe-bar :is(a, svg) {
		display: block;
	}

	.subscribe-bar path {
		fill: var(--color-white);
		transition: 150ms linear all;
	}

	.subscribe-bar svg:is(:focus, :hover, :active) path {
		fill: var(--color-yellow);
	}

	mark {
		background: var(--color-black);
		color: var(--color-white);
		display: inline-block;
		letter-spacing: 0.025em;
		padding-inline: 0.375rem;
		text-transform: uppercase;
	}

	.block .heading {
		font-size: 2.5rem;
		margin: 0 0 1rem;
		text-align: center;
	}

	.block .lede {
		margin: 0 auto 1rem;
		max-width: 45ch;
		text-align: center;
	}

	.block .lede:last-child {
		margin-block-end: 0;
	}

	.section-link {
		color: var(--color-pink-text);
		font-size: 0.875rem;
		font-weight: 600;
		text-decoration: none;
	}

	.episodes {
		display: flex;
		flex-wrap: wrap;
		gap: 2rem;
		margin-top: 1rem;
	}

	.latest,
	.next {
		width: 100%;
	}

	.details p {
		margin: 0.5rem 0 0;
	}

	.big-link {
		background: transparent;
		border: 2px solid var(--color-pink-text);
		border-radius: 0.25rem;
		color: var(--color-pink-text);
		display: inline-block;
		font-family: var(--font-family);
		font-size: 0.875rem;
		font-weight: 600;
		margin: 1rem 0 0;
		padding: 0.25rem 1rem;
		text-decoration: none;
	}

	:global(.poster) {
		height: auto;
		width: 100%;
	}

	.yt-videos {
		display: flex;
		flex-direction: column;
		gap: 1rem;
		margin: 1.5rem 0 0;
	}

	.yt-vid {
		width: 100%;
	}

	.yt-vid > a {
		display: block;
	}

	.yt-vid img {
		border-radius: 0.125rem;
		display: block;
		width: 100%;
	}

	.yt-vid p {
		font-size: 0.875rem;
		font-weight: normal;
		line-height: 1.25;
		margin: 0;
		padding: 0.5rem 0 0;
	}

	.yt-vid a {
		color: inherit;
		text-decoration: none;
	}

	.yt-vid a:is(:active, :focus, :hover) {
		text-decoration: underline;
	}

	@media (min-width: 550px) {
		.latest,
		.next {
			width: calc((100% - 2rem) / 2);
		}

		.yt-videos {
			flex-direction: row;
		}

		.yt-vid {
			width: calc((100% - 2rem) / 3);
		}
	}
</style>
